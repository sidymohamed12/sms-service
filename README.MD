# ğŸ“¡ SMS Service â€“ Module Spring Boot (Twilio, Infobip, Failover)

## ğŸ“Œ Description

Ce module fournit une **solution complÃ¨te et modulaire** pour l'envoi de SMS dans une architecture microservices.
Il prend en charge **plusieurs fournisseurs** (Twilio, Infobip, Orange SÃ©nÃ©gal) et inclut un **systÃ¨me de failover automatique**, garantissant **haute disponibilitÃ© et fiabilitÃ©**.

---

## ğŸš€ Objectifs

- Centraliser lâ€™envoi de SMS via un **service unique**.
- Permettre lâ€™utilisation de **plusieurs providers**.
- Garantir une **rÃ©silience Ã©levÃ©e** grÃ¢ce au **Failover**.
- Fournir des **API REST claires et documentÃ©es**.
- IntÃ©gration facile dans des microservices ou ERP existants.

---

## ğŸ§© FonctionnalitÃ©s principales

### âœ… Envoi de SMS via plusieurs providers

- **Twilio**
- **Infobip**
- Extensible : ajouter un provider = ajouter une classe implÃ©mentant `ISmsService`.

### âœ… Failover intelligent

- Liste de providers dÃ©finie dans `application.yml`.
- Tentative dans l'ordre : Twilio â†’ Infobip â†’ ...
- Basculer automatiquement si le provider principal Ã©choue.

### âœ… API REST simple

- Endpoints pour envoyer des SMS.
- RÃ©ponses standardisÃ©es avec `success`, `messageId` et `error`.

### âœ… Gestion des erreurs

- Exceptions centralisÃ©es via `SmsExceptionHandler`.
- Messages dâ€™erreur clairs pour faciliter le debug.

---

## ğŸ— Architecture

```
sms-service/
â”œâ”€â”€ src/main/java/com/sidy/sms_service/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ SmsConfiguration.java
â”‚   â”‚   â””â”€â”€ SmsProperties.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ SmsController.java
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ SmsRequest.java
â”‚   â”‚   â””â”€â”€ SmsResponse.java
â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”œâ”€â”€ SmsConfigurationException.java
â”‚   â”‚   â”œâ”€â”€ SmsException.java
â”‚   â”‚   â”œâ”€â”€ SmsExceptionHandler.java
â”‚   â”‚   â”œâ”€â”€ SmsProviderException.java
â”‚   â”‚   â””â”€â”€ SmsServiceException.java
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ ISmsService.java
â”‚       â””â”€â”€ impl/
â”‚           â”œâ”€â”€ FailoverSmsService.java
â”‚           â”œâ”€â”€ InfobipSmsService.java
â”‚           â””â”€â”€ TwilioSmsService.java
â”œâ”€â”€ src/main/resources/
â”‚   â””â”€â”€ application.yml
â”‚â”€â”€ pom.xml
â””â”€â”€ .env
```

- **ISmsService** â†’ Interface centrale.
- **TwilioSmsService / InfobipSmsService** â†’ ImplÃ©mentations concrÃ¨tes.
- **FailoverSmsService** â†’ GÃ¨re lâ€™ordre dynamique des providers.
- **SmsController** â†’ API REST.
- **SmsExceptionHandler** â†’ Centralise les erreurs.
- **SmsProperties** â†’ Mappe les propriÃ©tÃ©s `sms.*` du YAML.
- **SmsConfiguration** â†’ DÃ©clare le bean principal `ISmsService`.

---

## ğŸ›  Technologie

| Technologie           | RÃ´le                     |
| --------------------- | ------------------------ |
| **Spring Boot 3**     | Framework principal      |
| **Spring Web**        | API REST                 |
| **Spring Validation** | Validation des DTO       |
| **Lombok**            | RÃ©duction du boilerplate |
| **Twilio SDK**        | Envoi SMS via Twilio     |
| **Infobip REST SDK**  | Envoi SMS via Infobip    |
| **Java 21+**          | CompatibilitÃ©            |

---

## âš™ Installation des dÃ©pendances

**Twilio :**

```xml
<dependency>
  <groupId>com.twilio.sdk</groupId>
  <artifactId>twilio</artifactId>
  <version>8.33.0</version>
</dependency>
```

**Infobip :**

```xml
<dependency>
  <groupId>com.infobip</groupId>
  <artifactId>infobip-api-java-client</artifactId>
  <version>1.1.0</version>
</dependency>
```

**Unirest (HTTP client pour Infobip) :**

```xml
<dependency>
    <groupId>com.konghq</groupId>
    <artifactId>unirest-java</artifactId>
    <version>3.13.6</version>
</dependency>
```

---

## ğŸ›  Configuration `application.yml`

```yaml
sms:
  provider: failover
  failoverProviders:
    - twilio
    - infobip

  twilio:
    accountSid: ${TWILIO_ACCOUNT_SID}
    authToken: ${TWILIO_AUTH_TOKEN}
    fromNumber: ${TWILIO_PHONE_NUMBER}

  infobip:
    baseUrl: https://d8lmp8.api.infobip.com
    apiKey: ${INFOBIP_API_KEY}
    fromNumber: ${INFOBIP_SENDER}
```

### ğŸ”¹ Exemple `.env` (Ã  placer Ã  la racine du module)

```env
# Twilio
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# Infobip
INFOBIP_API_KEY=your_infobip_api_key
INFOBIP_SENDER=+0987654321
```

> âš ï¸ Les valeurs sensibles **ne doivent pas Ãªtre commitÃ©es**. Copier `.env.example` â†’ `.env` et remplir vos propres secrets.

---

## ğŸ§  Principes de conception

- **Single Responsibility Principle (SRP)** â†’ Chaque classe a un rÃ´le unique.
- **Open/Closed Principle (OCP)** â†’ Ajouter un provider sans modifier les classes existantes.
- **Dependency Injection** â†’ TestabilitÃ© et modularitÃ© amÃ©liorÃ©es.
- **Failover Pattern** â†’ Haute disponibilitÃ©.
- **TestabilitÃ©** â†’ Les providers implÃ©mentent `ISmsService` â†’ facilement mockables.

---

## ğŸ§ª Tests

- Tester le failover en simulant une panne dâ€™un provider.
- Mock des services Twilio et Infobip.
- Tester lâ€™API REST via Postman ou cURL :

```bash
curl -X POST http://localhost:8080/api/sms/send \
-H "Content-Type: application/json" \
-d '{"to":"+221761823698","message":"Test SMS"}'
```

---

## ğŸ‘¤ Auteur

**Sidy Mohamed Saizonou â€“ DÃ©veloppeur Fullstack**
âœ¨ PassionnÃ© par les architectures modulaires, microservices et DevOps.

---

## ğŸ“Œ Version & Support

| Ã‰lÃ©ment              | Valeur                          |
| -------------------- | ------------------------------- |
| Version module       | 1.0.1                           |
| CompatibilitÃ© Spring | 3.x                             |
| JDK                  | 17+                             |
| Support              | CrÃ©er une issue ou me contacter |
